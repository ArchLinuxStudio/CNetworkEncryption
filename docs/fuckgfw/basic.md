# 基本原理

在前面的两章，分别介绍了网络编程与密码学的知识，并且在最后实现了一个代理工具。但是这个代理工具仅仅是为了以最简要的形式说明运行的原理，并不具备实用性。本章将以火狐浏览器作为客户端，来实现一个为浏览器服务的代理工具。

实际上，网络封锁的突破本质上就是转发与加密的结合。转发可以将流量发送到远端以及将流量接收到本机，加密可以保证转发的过程是安全的，不被解析以及拦截。

对于转发的部分，实际上就是传统意义上的代理，关于这部分内容，可以参考《HTTP 权威指南》一书中第四章、第六章以及第八章中的内容，在这些章节中有详尽的描述。需要注意的是，这些章节中对于改写 HTTP 代理中接收到的完整路径为相对路径的步骤应该可以省略了，因为其是为兼容一些老旧的，不支持完整路径的服务器。除此之外，改写 Proxy-Connection 到 Connection 的操作也不是必要的了，因为在 HTTP1.1 中以及默认均为长链接，对于兼容 HTTP1.0 的情况下会出现的问题可详见书中的讨论。

对于加密的部分，是为了不让互联网审计系统能够检测到通讯内容，或者发现流量特征。一般网络封锁突破软件会通过预配置的方式实现加密密码的共享，也即在本机和远端服务器事先设置好密码与相关配置。

本章将以[mproxy](https://github.com/ArchLinuxStudio/mproxy)项目为范例，讲解一个能实际使用的代理软件是如何工作的。当然，mproxy 也只是一个范例程序，其中有很多不完善的地方，但其足以能够说明代理的工作方式。
